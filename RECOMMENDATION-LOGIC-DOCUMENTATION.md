# SwiftTaste æ¨è–¦ç³»çµ±é‚è¼¯æ–‡æª”

**ç‰ˆæœ¬**: 1.0
**æœ€å¾Œæ›´æ–°**: 2025-01-20
**ç‹€æ…‹**: ç”Ÿç”¢ç‰ˆæœ¬

---

## ğŸ“‹ æ¦‚è¿°

SwiftTaste æ¨è–¦ç³»çµ±åŒ…å«å…©ç¨®æ ¸å¿ƒæ¨¡å¼ï¼š
- **SwiftTaste æ¨¡å¼**ï¼šå€‹äººåŒ–å–®äººæ¨è–¦
- **Buddies æ¨¡å¼**ï¼šå¤šäººç¾¤é«”æ¨è–¦

å…©ç¨®æ¨¡å¼éƒ½åŸºæ–¼ç›¸åŒçš„è©•åˆ†æ©Ÿåˆ¶ï¼Œä½†åœ¨è¼¸å…¥è™•ç†å’Œç¯©é¸é‚è¼¯ä¸Šæœ‰æ‰€å·®ç•°ã€‚

---

## ğŸ”§ æ ¸å¿ƒé…ç½®

### æ¬Šé‡å¸¸æ•¸ (WEIGHT)

```javascript
const WEIGHT = {
  BASIC_MATCH: 10,     // åŸºæœ¬å•é¡ŒåŒ¹é…æ¬Šé‡
  FUN_MATCH: 5,        // è¶£å‘³å•é¡ŒåŒ¹é…æ¬Šé‡
  GROUP_CONSENSUS: 3,  // ç¾¤çµ„å…±è­˜çå‹µï¼ˆåƒ… Buddies æ¨¡å¼ï¼‰
  POPULARITY: 2,       // äººæ°£æ¬Šé‡
  DISTANCE: 2,         // è·é›¢æ¬Šé‡
  RATING: 1.5,         // è©•åˆ†æ¬Šé‡
  MIN_SCORE: 1         // æœ€ä½åˆ†æ•¸é–¾å€¼
};
```

### åŸºæœ¬å•é¡Œè­˜åˆ¥ç¬¦

```javascript
const BASIC_QUESTION_IDENTIFIERS = [
  "ä»Šå¤©æ˜¯ä¸€å€‹äººé‚„æ˜¯æœ‰æœ‹å‹ï¼Ÿ",
  "æƒ³åƒå¥¢è¯é»é‚„æ˜¯å¹³åƒ¹ï¼Ÿ",
  "æƒ³åƒæ­£é¤é‚„æ˜¯æƒ³å–é£²æ–™ï¼Ÿ",
  "åƒä¸€é»é‚„æ˜¯åƒé£½ï¼Ÿ",
  "é™„è¿‘åƒé‚„æ˜¯é ä¸€é»ï¼Ÿ",
  "æƒ³åƒè¾£çš„é‚„æ˜¯ä¸è¾£ï¼Ÿ"
];
```

---

## ğŸ¯ SwiftTaste æ¨¡å¼ï¼ˆå–®äººæ¨è–¦ï¼‰

### æ•¸æ“šåº«æ¬„ä½å°æ‡‰

| å•é¡Œé¡å‹ | ç”¨æˆ¶é¸é … | å°æ‡‰è³‡æ–™åº«æ¬„ä½ | ç¯©é¸é‚è¼¯ |
|---------|---------|---------------|----------|
| **äººæ•¸** | å–®äºº | `suggested_people` | åŒ…å« "1" |
| | å¤šäºº | `suggested_people` | åŒ…å« "~" |
| **åƒ¹æ ¼** | å¥¢è¯ç¾é£Ÿ | `price_range` | 3=å¥¢ä¾ˆ, 2=70%æ©Ÿç‡ |
| | å¹³åƒ¹ç¾é£Ÿ | `price_range` | 1=å¹³åƒ¹, 2=30%æ©Ÿç‡ |
| **é¤é»é¡å‹** | å– | `tags` | åŒ…å« "å–" æ¨™ç±¤ |
| | åƒä¸€é» | `tags` | åŒ…å« "åƒä¸€é»" æ¨™ç±¤ |
| | åƒé£½ | `tags` | åŒ…å« "åƒé£½" æ¨™ç±¤ |
| **è¾£åº¦** | è¾£ | `is_spicy` | `'true'` æˆ– `'both'` |
| | ä¸è¾£ | `is_spicy` | `'false'` æˆ– `'both'` |

### ç¯©é¸æµç¨‹

1. **å‰ç½®ç¯©é¸**ï¼šæ ¹æ“šåŸºæœ¬å•é¡Œç­”æ¡ˆé€²è¡Œè³‡æ–™åº«æ¬„ä½ç¯©é¸
2. **è©•åˆ†è¨ˆç®—**ï¼šç‚ºæ¯å®¶é¤å»³è¨ˆç®—åŒ¹é…åˆ†æ•¸
3. **æ’åºé¸æ“‡**ï¼šæŒ‰åˆ†æ•¸æ’åºä¸¦é¸å‡ºå‰10å

### è©•åˆ†è¨ˆç®—é‚è¼¯

```javascript
// åŸºæœ¬åŒ¹é…è©•åˆ†ï¼ˆå¿…é ˆå®Œå…¨ç¬¦åˆæ‰€æœ‰åŸºæœ¬æ¢ä»¶ï¼‰
let basicMatchCount = 0;

basicAnswers.forEach(answer => {
  let matched = false;

  switch(answer) {
    case "å¥¢è¯ç¾é£Ÿ":
      matched = price_range === 3 || (price_range === 2 && Math.random() < 0.7);
      break;
    case "å¹³åƒ¹ç¾é£Ÿ":
      matched = price_range === 1 || (price_range === 2 && Math.random() < 0.3);
      break;
    case "åƒ":
      matched = normalizedTags.includes("åƒä¸€é»") || normalizedTags.includes("åƒé£½");
      break;
    // ... å…¶ä»–åŒ¹é…é‚è¼¯
  }

  if (matched) {
    score += WEIGHT.BASIC_MATCH;
    basicMatchCount++;
  }
});

// åš´æ ¼åŸºæœ¬åŒ¹é…ï¼šå¿…é ˆç¬¦åˆæ‰€æœ‰åŸºæœ¬æ¢ä»¶ï¼Œå¦å‰‡ç›´æ¥æ’é™¤
if (basicAnswers.length > 0 && basicMatchCount < basicAnswers.length) {
  return 0; // ç›´æ¥è¿”å›0åˆ†ï¼Œç¢ºä¿è¢«éæ¿¾æ‰
}
```

### ç‰¹æ®Šè™•ç†æ©Ÿåˆ¶

1. **åš´æ ¼åŸºæœ¬åŒ¹é…**ï¼šé¤å»³å¿…é ˆç¬¦åˆ**æ‰€æœ‰**åŸºæœ¬æ¢ä»¶ï¼Œä¸ç¬¦åˆä»»ä¸€æ¢ä»¶ç›´æ¥æ’é™¤
2. **æ©Ÿç‡æ€§åƒ¹æ ¼åŒ¹é…**ï¼šprice_range = 2 æ™‚ä½¿ç”¨æ©Ÿç‡åˆ†é…
3. **é¤é»é¡å‹å±¤ç´š**ï¼š"åƒ" åŒ¹é… "åƒä¸€é»" æˆ– "åƒé£½"
4. **è¶£å‘³å•é¡Œæ¨™ç±¤æ˜ å°„**ï¼šä½¿ç”¨ `funQuestionTagsMap` é€²è¡Œèªæ„åŒ¹é…
5. **è©•åˆ†åŠ æ¬Š**ï¼šé¤å»³è©•åˆ†è½‰æ›ç‚º 0-1 æ¬Šé‡å¾ŒåŠ å…¥ç¸½åˆ†
6. **é›¶åˆ†éæ¿¾**ï¼šè©•åˆ†ç‚º0çš„é¤å»³åœ¨æœ€çµ‚ç¯©é¸éšæ®µè¢«å®Œå…¨æ’é™¤

---

## ğŸ‘¥ Buddies æ¨¡å¼ï¼ˆå¤šäººæ¨è–¦ï¼‰

### æŠ•ç¥¨è™•ç†æ©Ÿåˆ¶

1. **æ”¶é›†ç­”æ¡ˆ**ï¼šæ”¶é›†æ‰€æœ‰ç”¨æˆ¶å°æ¯å€‹åŸºæœ¬å•é¡Œçš„ç­”æ¡ˆ
2. **è¨ˆç®—æ¬Šé‡ç¥¨æ•¸**ï¼š
   - ä¸€èˆ¬æˆå“¡ï¼š1ç¥¨
   - æˆ¿ä¸»ï¼š2ç¥¨ï¼ˆé›™å€æ¬Šé‡ï¼‰
3. **æ±ºå®šæœ€çµ‚ç­”æ¡ˆ**ï¼š
   - å–®ä¸€æœ€é«˜ç¥¨ï¼šç›´æ¥æ¡ç”¨
   - å¤šå€‹æœ€é«˜ç¥¨ï¼ˆå¹³ç¥¨ï¼‰ï¼šå„ªå…ˆä½¿ç”¨æˆ¿ä¸»é¸æ“‡
   - ç„¡æˆ¿ä¸»é¸æ“‡ï¼šä½¿ç”¨ç¬¬ä¸€å€‹æœ€é«˜ç¥¨é¸é …

### æŠ•ç¥¨ç®—æ³•

```javascript
// è¨ˆç®—æ¯å€‹é¸é …çš„ç¥¨æ•¸
const voteCount = {};
answers.forEach((answer, userIndex) => {
  if (answer) {
    const weight = (isHost && userIndex === 0) ? 2 : 1;
    voteCount[answer] = (voteCount[answer] || 0) + weight;
  }
});

// æ‰¾å‡ºæœ€é«˜ç¥¨æ•¸é¸é …
const maxVotes = Math.max(...Object.values(voteCount));
const maxVotedOptions = Object.entries(voteCount)
  .filter(([_, count]) => count === maxVotes)
  .map(([option]) => option);
```

### æ¨è–¦ç”Ÿæˆæµç¨‹

1. **æ°‘ä¸»æ±ºç­–**ï¼šé€šéæŠ•ç¥¨ç¢ºå®šç¾¤çµ„åå¥½
2. **é¤å»³ç¯©é¸**ï¼šä½¿ç”¨ç¾¤çµ„æ±ºç­–çµæœç¯©é¸é¤å»³
3. **è©•åˆ†æ’åº**ï¼šä½¿ç”¨ç›¸åŒçš„ `calculateMatchScore` å‡½æ•¸
4. **çµæœè¼¸å‡º**ï¼šè¿”å›æŒ‰åˆ†æ•¸æ’åºçš„æ¨è–¦åˆ—è¡¨

---

## ğŸ”„ å…±åŒè©•åˆ†ç³»çµ±

### calculateMatchScore å‡½æ•¸

å…©ç¨®æ¨¡å¼éƒ½ä½¿ç”¨ç›¸åŒçš„è©•åˆ†å‡½æ•¸ç¢ºä¿ä¸€è‡´æ€§ï¼š

```javascript
function calculateMatchScore(restaurant, basicAnswers, basicQuestions, funAnswers, userLocation, options) {
  let score = WEIGHT.MIN_SCORE;

  // 1. åŸºæœ¬å•é¡ŒåŒ¹é…
  basicAnswers.forEach(answer => {
    // æ ¹æ“šansweré¡å‹é€²è¡ŒåŒ¹é…åˆ¤æ–·
    if (matched) {
      score += WEIGHT.BASIC_MATCH;
    }
  });

  // 2. è¶£å‘³å•é¡ŒåŒ¹é…
  if (funAnswers.length > 0) {
    const funMatchScore = calculateFunQuestionMatch(funAnswers, restaurantTags);
    score += funMatchScore * WEIGHT.FUN_MATCH;
  }

  // 3. è©•åˆ†æ¬Šé‡
  if (rating > 0) {
    score += Math.min(rating / 5, 1) * WEIGHT.RATING;
  }

  // 4. å®Œå…¨åŒ¹é…çå‹µ
  if (basicMatchCount === basicAnswers.length) {
    score += WEIGHT.BASIC_MATCH * 0.5;
  }

  return score;
}
```

---

## ğŸ“Š è¶£å‘³å•é¡Œæ¨™ç±¤æ˜ å°„

è¶£å‘³å•é¡Œé€šéé å®šç¾©çš„æ¨™ç±¤æ˜ å°„è¡¨é€²è¡Œèªæ„åŒ¹é…ï¼š

```javascript
// ç¯„ä¾‹æ˜ å°„
const funQuestionTagsMap = {
  "å´èƒŒåŒ…": ["ç²¾ç·»","å’–å•¡å»³", "æ–‡é’", "å°åº—","ç¾ä»£","ç°¡ç´„","å·¥æ¥­"],
  "å¾ŒèƒŒåŒ…": ["æˆ¶å¤–", "ä¼‘é–’", "æ´»åŠ›", "å¤§å‹","é„‰æ‘", "èˆŠ", "ç†±æƒ…"],
  "åŠ›å¤§ç„¡çª®": ["é„‰æ‘", "å¾©å¤", "å°å¼", "æ—¥å¼", "æ˜äº®æ´»æ½‘", "å‹•æ„Ÿåè¶³", "å–œæ°£", "å‹å–„", "ç˜‹ç‹‚", "èˆŠ", "åƒé£½", "é‡å£å‘³", "å¤§ä»½é‡", "çƒ¤è‚‰"]
  // ... æ›´å¤šæ˜ å°„
};
```

---

## âš ï¸ é‡è¦æ›´æ–°è¨˜éŒ„

### 2025-01-20 æ›´æ–°
- **æ¨™ç±¤çµ±ä¸€**ï¼šå°‡æ‰€æœ‰ "é£½è¶³" æ¨™ç±¤çµ±ä¸€æ›´æ–°ç‚º "åƒé£½"
- **è³‡æ–™åº«æ¬„ä½ä¿®æ­£**ï¼šç¢ºèªä½¿ç”¨æ­£ç¢ºçš„è³‡æ–™åº«æ¬„ä½æ˜ å°„
- **é‚è¼¯ä¸€è‡´æ€§**ï¼šçµ±ä¸€å‰å¾Œç«¯æ¨è–¦é‚è¼¯
- **åš´æ ¼åŸºæœ¬åŒ¹é…**ï¼šå¼·åŒ–åŸºæœ¬æ¢ä»¶æª¢æŸ¥ï¼Œä¸ç¬¦åˆæ‰€æœ‰åŸºæœ¬æ¢ä»¶çš„é¤å»³ç›´æ¥æ’é™¤ï¼ˆè¿”å›0åˆ†ï¼‰
- **è¾£åº¦ç¯©é¸ä¿®æ­£**ï¼šä¿®æ­£å‰å¾Œç«¯ `is_spicy` æ¬„ä½åç¨±ä¸ä¸€è‡´å•é¡Œï¼Œç¢ºä¿è¾£åº¦ç¯©é¸æ­£å¸¸å·¥ä½œ
- **è¾£åº¦æ¬„ä½æ“´å±•**ï¼šæ–°å¢ `'both'` é¸é …ï¼Œæ”¯æ´åŒæ™‚æä¾›è¾£å’Œä¸è¾£é¸æ“‡çš„é¤å»³

### å—å½±éŸ¿çš„æ–‡ä»¶
- `src/components/SwiftTaste.jsx`
- `src/data/funQuestionTags.js`
- `server/data/funQuestionTags.js`
- `server/logic/enhancedRecommendLogicBackend.js`
- `src/logic/enhancedRecommendLogicFrontend.js`

---

## ğŸ”§ æŠ€è¡“å¯¦ç¾ç´°ç¯€

### æ–‡ä»¶çµæ§‹

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ SwiftTaste.jsx              // å–®äººæ¨¡å¼ä¸»çµ„ä»¶
â”‚   â””â”€â”€ BuddiesRoom.jsx             // å¤šäººæ¨¡å¼ä¸»çµ„ä»¶
â”œâ”€â”€ logic/
â”‚   â””â”€â”€ enhancedRecommendLogicFrontend.js  // å‰ç«¯æ¨è–¦é‚è¼¯
â”œâ”€â”€ data/
â”‚   â””â”€â”€ funQuestionTags.js          // è¶£å‘³å•é¡Œæ¨™ç±¤æ˜ å°„
â””â”€â”€ services/
    â””â”€â”€ supabaseService.js          // è³‡æ–™åº«æœå‹™

server/
â”œâ”€â”€ logic/
â”‚   â””â”€â”€ enhancedRecommendLogicBackend.js   // å¾Œç«¯æ¨è–¦é‚è¼¯
â””â”€â”€ data/
    â””â”€â”€ funQuestionTags.js          // å¾Œç«¯æ¨™ç±¤æ˜ å°„
```

### è³‡æ–™åº« Schema

```sql
-- restaurants è¡¨ç›¸é—œæ¬„ä½
restaurants (
  id UUID PRIMARY KEY,
  name TEXT NOT NULL,
  suggested_people TEXT,        -- "1", "~", "1~" ç­‰
  price_range INTEGER,          -- 1=å¹³åƒ¹, 2=ä¸­ç­‰, 3=å¥¢è¯
  tags TEXT[],                 -- åŒ…å«é¤é»é¡å‹å’Œå…¶ä»–æ¨™ç±¤
  is_spicy BOOLEAN,            -- è¾£åº¦æ¨™è¨˜
  rating DECIMAL,              -- é¤å»³è©•åˆ†
  is_active BOOLEAN DEFAULT true
);
```

---

## ğŸš€ æ•ˆèƒ½å„ªåŒ–å»ºè­°

1. **ç´¢å¼•å„ªåŒ–**ï¼š
   ```sql
   CREATE INDEX idx_restaurants_active ON restaurants(is_active);
   CREATE INDEX idx_restaurants_price_range ON restaurants(price_range);
   CREATE INDEX idx_restaurants_tags ON restaurants USING GIN(tags);
   ```

2. **æŸ¥è©¢å„ªåŒ–**ï¼š
   - å„ªå…ˆä½¿ç”¨ç²¾ç¢ºæ¬„ä½ç¯©é¸æ¸›å°‘å€™é¸é›†
   - æ¨™ç±¤æŸ¥è©¢ä½¿ç”¨ GIN ç´¢å¼•æå‡æ•ˆèƒ½

3. **å¿«å–ç­–ç•¥**ï¼š
   - è¶£å‘³å•é¡Œæ¨™ç±¤æ˜ å°„çµæœå¿«å–
   - å¸¸ç”¨ç¯©é¸çµ„åˆçµæœå¿«å–

---

## ğŸ“ ç¶­è­·æŒ‡å—

### ä¿®æ”¹æ¨è–¦é‚è¼¯æ™‚éœ€è¦æ›´æ–°çš„æ–‡ä»¶

1. **æ ¸å¿ƒé‚è¼¯æ–‡ä»¶**ï¼š
   - `src/logic/enhancedRecommendLogicFrontend.js`
   - `server/logic/enhancedRecommendLogicBackend.js`

2. **UIçµ„ä»¶**ï¼š
   - `src/components/SwiftTaste.jsx`
   - `src/components/BuddiesRoom.jsx`

3. **é…ç½®æ–‡ä»¶**ï¼š
   - `src/data/funQuestionTags.js`
   - `server/data/funQuestionTags.js`

4. **æ–‡æª”**ï¼š
   - `RECOMMENDATION-LOGIC-DOCUMENTATION.md` (æœ¬æ–‡ä»¶)

### æ¸¬è©¦æª¢æŸ¥æ¸…å–®

- [ ] SwiftTaste æ¨¡å¼åŸºæœ¬ç¯©é¸åŠŸèƒ½
- [ ] Buddies æ¨¡å¼æŠ•ç¥¨æ©Ÿåˆ¶
- [ ] è©•åˆ†è¨ˆç®—æº–ç¢ºæ€§
- [ ] é‚Šç•Œæ¢ä»¶è™•ç†
- [ ] è³‡æ–™åº«æŸ¥è©¢æ•ˆèƒ½
- [ ] å‰å¾Œç«¯é‚è¼¯ä¸€è‡´æ€§

---

## ğŸ“ æ”¯æ´èˆ‡å•é¡Œå›å ±

å¦‚ç™¼ç¾æ¨è–¦é‚è¼¯å•é¡Œæˆ–éœ€è¦åŠŸèƒ½å¢å¼·ï¼Œè«‹ï¼š

1. æª¢æŸ¥æœ¬æ–‡æª”ç¢ºèªç•¶å‰é‚è¼¯è¨­è¨ˆ
2. é©—è­‰è³‡æ–™åº«è³‡æ–™æ­£ç¢ºæ€§
3. ç¢ºèªå‰å¾Œç«¯ä»£ç¢¼ä¸€è‡´æ€§
4. æä¾›å…·é«”çš„å•é¡Œæè¿°å’Œé‡ç¾æ­¥é©Ÿ

---

**æ–‡æª”ç¶­è­·è€…**: é–‹ç™¼åœ˜éšŠ
**ä¸‹æ¬¡å¯©æŸ¥æ™‚é–“**: åŠŸèƒ½æ›´æ–°æ™‚åŒæ­¥æ›´æ–°